<!--  
 * Chart Service for the GLIMMPSE Software System.  Generic
 * scatter plot service.  Used within Glimmpse for power curves.
 * 
 * Copyright (C) 2010 Regents of the University of Colorado.  
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
-->
<head>
<title>GLIMMPSE: Chart Service REST API</title>
 <STYLE type="text/css">
  H1 {
    border-width: 1; border: solid; 
    text-align: center; 
    background: #005C84;
    color: white;
   ;}
 
 div.toc {
 }
 
 div.toc1 {
 	text-indent: 40px;
 }
 
 div.toc2 {
 	text-indent: 60px;
 }
 
 td.borderRight {
 	border-right: 1px solid #000;
 	text-align: center;
 }
 </STYLE>
</head>
<body>
<h1>GLIMMPSE: Chart Service REST API</h1>

<h2>Introduction</h2>

The Glimmpse software system provides a web based user interface to estimate power and sample size
for the general linear multivariate model (GLMM) with or without a baseline covariate.  The Glimmpse system
consists of four main components:
<ul>
<li>Glimmpse.com user interface - a Javascript/GWT front-end user interface</li>
<li>Power Service - RESTful Java web service which processes power/sample size requests</li>
<li><b>Chart Service</b> - RESTful Java web service which produces graphs.  For the Glimmpse system, this service
produces power curves.</li>
<li>File Service - Java web service providing upload/save functionality for study design information</li>
<li>JavaStatistics library - low level library containing routines for computing GLMM power</li>
</ul>
This document describes the REST API for the Chart Service.  It assumes basic familiarity with 
<a href="http://www.w3.org/Protocols/">HTTP</a>, 
<a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">REST</a>, 
<a href="http://www.w3schools.com/html/html_forms.asp">HTML forms</a>, and the GLMM.  
For additional background on GLMM power calculations when controlling for a baseline covariate, please see 
<a href="http://www.ncbi.nlm.nih.gov/pubmed/12898543">Glueck &amp; Muller 2003</a>

<h3>Table of Contents</h3>
<div class="toc">
<div class="toc1"><a href="#chart">1. The Chart Service</a></div>
<div class="toc1"><a href="#plot">2. Creating Scatter Plots</a></div>
<div class="toc2"><a href="#chartSpec">2.1 Chart Specification</a></div>
<div class="toc1"><a href="#save">3. Saving Scatter Plots</a></div>
</div>

<h2><a name="chart">1. The Chart Service</a></h2>
<p>
The Chart Service component of the Glimmpse system is a RESTful Java web service 
which provides scatter plot capabilities for the Glimmpse user interface.  This service is 
used to produce power curve images. The service itself is generic, and can be used to
create basic scatter plots with multiple data series.
</p>
<p>
The Glimmpse user interface calls this service to allow users to create a scatter plot of their
power results, which is displayed on the final results screen.  Note that images are not
persistent on the server side, so saving the image requires an additional call into the chart 
service.
</p>
<p>
The service is implemented using the <a href="http://www.restlet.org/">Restlet Framework</a>.
Requests to the file service are received via an <a href="http://www.w3schools.com/html/html_forms.asp">HTML form</a> submission from the Glimmpse user interface.
</p>
<p>
The Chart Service was developed and tested for use within the <a href="http://tomcat.apache.org/">Apache Tomcat Server (v 6.0)</a>.
</p>

<h2><a name="plot">2. Creating Scatter Plots</a></h2>

The chart service supports 2D scatter plots with one or more data series. 
The user may also specify the plot title, axis labels and limits, and may 
show/hide the plot legend. Scatter plots are returned as JPEG images to 
the calling application.  
<p>
 Images are created dynamically and are <u>not</u> persistent on the server side. 
In addition, since the POST method is used to create the images, the standard 
"Save Image As..." in the client browser will not work (although "Copy Image" will).
A separate REST call may be used to <a href="#save">save an image</a>.
</p>
<p>
Scatter plots are created with the following URI
<pre>
POST /chart/scatter
</pre>
The entity body should be form encoded with the following structure:
<pre>
chart=<i>url-encoded-chart-specification</i>&save=[true|false]
</pre>
The request returns a JPEG image to the caller.

<h3><a name="chartSpec">Chart Specification</a></h3>

The chart specification is encoded as XML.  It is then url encoded and specified as the value
of the "chart" form element.  
<p>
Form encoding was used to allow the image to be posted to
an <a href="http://www.w3schools.com/tags/tag_iframe.asp">IFrame</a>.  At the time of this writing,
not all browsers supported dynamic image display through AJAX calls, so forms were the most reasonable
alternative.
</p>
The chart specification has the following format:
<pre>
&lt;chart title='<i>chartTitle</i>' legend='[true|false]'&gt;
&lt;xaxis label='<i>axisLabel</i>' min='<i>minimumAxisValue</i>' max='<i>maximumAxisValue</i>' /&gt;
&lt;yaxis label='<i>axisLabel</i>' min='<i>minimumAxisValue</i>' max='<i>maximumAxisValue</i>' /&gt;
&lt;series label='<i>seriesLabel</i>'&gt;
&lt;p x='<i>xCoordinate</i>' y='yCoordinate' /&gt;...&lt;p x='<i>xCoordinate</i>' y='yCoordinate' /&gt;
&lt;/series&gt;
...
&lt;series label='<i>seriesLabel</i>'&gt;
&lt;p x='<i>xCoordinate</i>' y='yCoordinate' /&gt;...&lt;p x='<i>xCoordinate</i>' y='yCoordinate' /&gt;
&lt;/series&gt;
&lt;/chart&gt;
</pre>
<h4>Chart Tag</h4>

The chart tag encloses the overall chart specification.  It takes two optional arguments.
<p/>
<table border='1'>
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>title</td><td>String</td><td>(Optional) The title for the chart.  If not specified, the chart will have no title.  
Note that titles cannot currently contain double quotes (known issue to be fixed in later version).</td></tr>
<tr><td>legend</td><td>boolean</td><td>(Optional) If 'true', a legend will be displayed in the image</td></tr>
</table>

<h4>Xaxis, Yaxis Tags</h4>

The xaxis tag is used to configure the horizontal axis on the plot, and the yaxis tag is used to
configure the vertical axis on the plot.  Only one xaxis and one yaxis tag should be specified within
a given chart tag.  Both tags take the following arguments.
<p/>

<table border='1'>
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>label</td><td>String</td><td>(Required) The label for the axis.  If not specified, the axis will not have a label.  
Note that labels cannot currently contain double quotes (known issue to be fixed in later version).</td></tr>
<tr><td>min</td><td>Number</td><td>(Optional) The lower limit for displayed values on this axis</td></tr>
<tr><td>max</td><td>Number</td><td>(Optional) The upper limit for displayed values on this axis</td></tr>
</table>

<h4>Series Tag</h4>

The series tag contains the actual data displayed on the plot.  The chart tag can contain one or more series tags.
The series tag has a single required argument:
<p/>
<table border='1'>
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>label</td><td>String</td><td>(Required) The label for the data series.  This will be displayed in 
the legend if legend='true' in the enclosing chart tag.</td></tr>
</table>
<p/>
The series tag encloses a series of coordinate pairs which are specified with the "p" tag.  Each "p" tag takes
the following arguments:
<p/>
<table border='1'>
<tr><th>Variable</th><th>Type</th><th>Description</th></tr>
<tr><td>x</td><td>Number</td><td>(Required) The X coordinate for this point</td></tr>
<tr><td>y</td><td>Number</td><td>(Required) The Y coordinate for this point</td></tr>
</table>
<p/>

<h2><a name="save">3. Saving Scatter Plots</a></h2>

To save a plot image from the client browser, the user must re-issue the request used to create the image,
and must include the "save" flag set to true.  Save requests are issued to the same URI as image creation:
<pre>
POST /chart/scatter/
</pre>
The <a href="#chartSpec">chart specification</a> is unchanged from scatter plot creation, and the entity 
body is form-encoded with the structure:
<pre>
chart=<i>url-encoded-chart-specification</i>&save=true
</pre>
The scatter plot is still returned as a JPEG image, but the request includes additional headers to initiate 
a "save as" event in the client's browser.
<pre>
Content-type: application/force-download
Content-disposition: attachment; filename=chart.jpg
</pre>
These headers trigger the client's browser to display the save dialog.  The user can then open the file or 
download it to their local machine.

<hr></hr>
Author: Sarah Kreidler<br/>
Last Updated: August 2010
</body>
